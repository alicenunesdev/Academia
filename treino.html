<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Treino</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      background: #f7f9fc;
      color: #333;
      display: flex;
      min-height: 100vh;
    }

    .navbar {
      background: #34495e;
      color: #ecf0f1;
      width: 220px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
      position: fixed;
    }

    .navbar h2 {
      margin: 0 0 40px;
      font-weight: 700;
      font-size: 1.8rem;
      text-align: center;
    }

    .navbar a {
      color: #bdc3c7;
      text-decoration: none;
      padding: 12px 20px;
      margin-bottom: 12px;
      border-radius: 6px;
      transition: background 0.3s, color 0.3s;
      font-weight: 600;
      display: block;
    }

    .navbar a:hover,
    .navbar a.active {
      background: #2980b9;
      color: white;
    }

    .main-content {
      margin-left: 220px;
      padding: 40px 30px;
      flex: 1;
      max-width: 100%;
    }

    .exercise-card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
      max-width: 600px;
      margin: 0 auto;
      text-align: center;
    }

    .exercise-card h2 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: #2c3e50;
    }

    .exercise-card p {
      font-size: 1.1rem;
      margin: 8px 0;
    }

    .exercise-card input {
      margin-top: 10px;
      padding: 8px 12px;
      font-size: 1rem;
      border: 1.5px solid #ccc;
      border-radius: 6px;
      width: 80px;
      text-align: center;
    }

    .buttons {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .buttons button {
      padding: 12px 24px;
      font-weight: 600;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .complete {
      background: #27ae60;
      color: white;
    }

    .complete:hover {
      background: #1f8b4d;
    }

    .skip {
      background: #f39c12;
      color: white;
    }

    .skip:hover {
      background: #d78b0e;
    }

    .end {
      background: #e74c3c;
      color: white;
    }

    .end:hover {
      background: #c0392b;
    }

    @media(max-width: 768px) {
      .navbar {
        width: 60px;
        padding: 20px 5px;
      }

      .navbar h2 {
        display: none;
      }

      .navbar a {
        padding: 12px 8px;
        font-size: 0;
      }

      .main-content {
        margin-left: 60px;
        padding: 20px;
      }

      .exercise-card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <h2>Academia</h2>
    <a href="index.html">Cadastro</a>
    <a href="visualizar.html">Visualizar</a>
    <a href="treino.html" class="active">Treino</a>
  </nav>

  <main class="main-content">
    <div class="exercise-card" id="exerciseCard" style="display:none;">
      <h2 id="exerciseName"></h2>
      <p><strong>Séries:</strong> <span id="seriesCount"></span></p>
      <p><strong>Repetições:</strong> <span id="repetitionsCount"></span></p>

      <div style="margin-top: 20px;">
        <label for="carga"><strong>Carga (kg):</strong></label><br>
        <input type="number" id="carga" placeholder="Kg" min="0" />
      </div>

      <div class="buttons">
        <button class="complete" id="btnComplete">Completar</button>
        <button class="skip" id="btnSkip">Pular</button>
        <button class="end" id="btnEnd">Encerrar</button>
      </div>

      <div id="cronometro" style="margin-top:20px; font-weight:600; font-size:1.2rem; color:#e67e22;"></div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQZrwPVmbcNZTEcGdqqE-Hscn2TS-hnwY",
      authDomain: "academia-bd-9d4da.firebaseapp.com",
      projectId: "academia-bd-9d4da",
      storageBucket: "academia-bd-9d4da.appspot.com",
      messagingSenderId: "201289997890",
      appId: "1:201289997890:web:19bece6aa0b3d52e3417db",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const exerciseCard = document.getElementById("exerciseCard");
    const exerciseName = document.getElementById("exerciseName");
    const seriesCount = document.getElementById("seriesCount");
    const repetitionsCount = document.getElementById("repetitionsCount");
    const cargaInput = document.getElementById("carga");
    const btnComplete = document.getElementById("btnComplete");
    const btnSkip = document.getElementById("btnSkip");
    const btnEnd = document.getElementById("btnEnd");
    const cronometroDisplay = document.getElementById("cronometro");

    let treinoExercicios = [];
    let currentIndex = 0;
    let timerInterval = null;
    let timerSeconds = 0;

    async function carregarExercicios() {
      try {
        const snapshot = await getDocs(collection(db, "treinos"));
        treinoExercicios = [];

        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          if(data.grupos && Array.isArray(data.grupos)) {
            data.grupos.forEach(grupo => {
              if(grupo.exercicios && Array.isArray(grupo.exercicios)) {
                grupo.exercicios.forEach(exercicio => {
                  treinoExercicios.push({
                    nome: exercicio.nome || grupo.grupo || "Exercício",
                    serie: exercicio.serie || grupo.serie || "-",
                    repeticao: exercicio.repeticao || grupo.repeticao || "-",
                  });
                });
              }
            });
          }
        });

        if(treinoExercicios.length > 0) {
          mostrarExercicio(0);
        } else {
          exerciseCard.style.display = "none";
          alert("Nenhum exercício encontrado.");
        }
      } catch(e) {
        console.error("Erro ao carregar exercícios:", e);
        alert("Erro ao carregar exercícios. Veja o console.");
      }
    }

    function mostrarExercicio(index) {
      if (index < 0 || index >= treinoExercicios.length) {
        alert("Fim do treino!");
        exerciseCard.style.display = "none";
        pararCronometro();
        return;
      }
      currentIndex = index;
      const exercicio = treinoExercicios[index];
      exerciseName.textContent = exercicio.nome;
      seriesCount.textContent = exercicio.serie;
      repetitionsCount.textContent = exercicio.repeticao;
      cargaInput.value = "";
      exerciseCard.style.display = "block";
      iniciarCronometro();
    }

    function iniciarCronometro() {
      pararCronometro();
      timerSeconds = 0;
      cronometroDisplay.textContent = formatarTempo(timerSeconds);
      timerInterval = setInterval(() => {
        timerSeconds++;
        cronometroDisplay.textContent = formatarTempo(timerSeconds);
      }, 1000);
    }

    function pararCronometro() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function formatarTempo(segundos) {
      const min = Math.floor(segundos / 60);
      const seg = segundos % 60;
      return `${String(min).padStart(2,'0')}:${String(seg).padStart(2,'0')}`;
    }

    btnComplete.addEventListener("click", () => {
      alert(`Exercício "${treinoExercicios[currentIndex].nome}" completo!`);
      mostrarExercicio(currentIndex + 1);
    });

    btnSkip.addEventListener("click", () => {
      alert(`Exercício "${treinoExercicios[currentIndex].nome}" pulado!`);
      mostrarExercicio(currentIndex + 1);
    });

    btnEnd.addEventListener("click", () => {
      pararCronometro();
      exerciseCard.style.display = "none";
      alert("Treino encerrado!");
    });

    carregarExercicios();
  </script>
</body>
</html>
