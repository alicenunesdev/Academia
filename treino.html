<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Iniciar Treino</title>
<style>
  * {
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    margin: 0;
    background: #f7f9fc;
    color: #333;
    display: flex;
    min-height: 100vh;
    flex-direction: column;
  }

  .navbar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: #2c3e50;
    color: #ecf0f1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 1000;
  }

  .navbar h2 {
    margin: 0;
    font-weight: 700;
    font-size: 1.6rem;
  }

  .hamburguer {
    display: none;
    flex-direction: column;
    cursor: pointer;
    width: 25px;
    height: 20px;
    justify-content: space-between;
  }

  .hamburguer span {
    display: block;
    height: 3px;
    background: #ecf0f1;
    border-radius: 2px;
  }

  .navbar-links {
    display: flex;
    gap: 20px;
  }

  .navbar a {
    color: #bdc3c7;
    text-decoration: none;
    padding: 8px 14px;
    border-radius: 6px;
    transition: background 0.3s, color 0.3s;
    font-weight: 600;
  }

  .navbar a:hover,
  .navbar a.active {
    background: #2980b9;
    color: white;
  }

  .main-content {
    padding: 100px 30px 40px;
    flex: 1;
    max-width: 100%;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
    font-weight: 700;
    color: #2c3e50;
  }

  .card {
    background: white;
    color: #333;
    margin: 20px auto;
    padding: 20px;
    max-width: 500px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .atividade-header {
    text-align: center;
    margin-bottom: 20px;
  }

  .atividade-header h2 {
    font-size: 1.8rem;
    color: #2c3e50;
  }

  .series div {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .series input[type="number"] {
    width: 60px;
    padding: 5px;
  }

  .botao-feito {
    background: #ecf0f1;
    color: #2c3e50;
    border: none;
    padding: 2px 4px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.7rem;
    transition: background 0.3s;
  }

  .botao-feito.ativo {
    background: #2ecc71;
    color: white;
  }

  .botao-reiniciar {
    background: #f1c40f;
    color: #2c3e50;
    border: none;
    padding: 2px 4px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.7rem;
    transition: background 0.3s;
  }

  .botao-reiniciar:hover {
    background: #f39c12;
    color: white;
  }

  .cronometro-serie {
    font-size: 0.9rem;
    color: #e67e22;
  }

  .hidden {
    display: none;
  }

  .botoes-controle {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
  }

  .botao-pular, .botao-completar, .botao-encerrar {
    flex: 1;
    margin: 0 5px;
    padding: 12px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
  }

  .botao-pular {
    background: #8e44ad;
    color: white;
  }

  .botao-completar {
    background: #2ecc71;
    color: white;
  }

  .botao-encerrar {
    background: #c0392b;
    color: white;
  }

  .botao-encerrar:hover {
    background: #922b21;
  }

  select, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  button {
    background: #2980b9;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background: #2471a3;
  }

  @media (max-width: 768px) {
    .navbar {
      flex-direction: row;
      align-items: center;
      padding: 10px 20px;
    }

    .hamburguer {
      display: flex;
    }

    .navbar-links {
      position: absolute;
      top: 60px;
      left: 0;
      right: 0;
      background: #2c3e50;
      flex-direction: column;
      width: 100%;
      gap: 0;
      display: none;
      border-top: 1px solid #34495e;
    }

    .navbar-links.open {
      display: flex;
    }

    .navbar-links a {
      padding: 15px 20px;
      border-bottom: 1px solid #34495e;
    }

    .main-content {
      padding: 120px 20px 40px;
    }
  }
</style>
</head>
<body>

<nav class="navbar">
  <h2>Academia</h2>
  <div class="hamburguer" id="hamburguer">
    <span></span><span></span><span></span>
  </div>
  <div class="navbar-links" id="navbarLinks">
    <a href="index.html">Cadastro</a>
    <a href="visualizar.html">Visualizar</a>
    <a href="treino.html" class="active">Treino</a>
    <a href="historico.html">Historico</a>
  </div>
</nav>

<main class="main-content">
  <h1>Iniciar Treino</h1>
  <div class="card">
    <label for="treinoSelect">Selecione um treino:</label>
    <select id="treinoSelect">
      <option value="">Carregando...</option>
    </select>
    <button id="iniciarBtn">Iniciar Treino</button>
  </div>
  <div id="treinoContainer"></div>
</main>

<script>
const hamburguer = document.getElementById("hamburguer");
const navbarLinks = document.getElementById("navbarLinks");
hamburguer.addEventListener("click", () => {
  navbarLinks.classList.toggle("open");
});
</script>

<script type="module">
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDoc, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQZrwPVmbcNZTEcGdqqE-Hscn2TS-hnwY",
  authDomain: "academia-bd-9d4da.firebaseapp.com",
  projectId: "academia-bd-9d4da",
  storageBucket: "academia-bd-9d4da.appspot.com",
  messagingSenderId: "201289997890",
  appId: "1:201289997890:web:19bece6aa0b3d52e3417db",
  measurementId: "G-3J2FY1DEGW"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const treinoSelect = document.getElementById("treinoSelect");
const iniciarBtn = document.getElementById("iniciarBtn");
const treinoContainer = document.getElementById("treinoContainer");

let atual = 0;
let grupos = [];
let dadosPreenchidos = {};
const timers = {};

async function carregarTreinos() {
  const snapshot = await getDocs(collection(db, "treinos"));
  treinoSelect.innerHTML = '<option value="">Selecione</option>';
  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    const option = document.createElement("option");
    option.value = docSnap.id;
    option.textContent = `${data.usuario} - ${data.tipoTreino}`;
    treinoSelect.appendChild(option);
  });
}

carregarTreinos();

iniciarBtn.addEventListener("click", async () => {
  const treinoId = treinoSelect.value;
  if (!treinoId) {
    alert("Selecione um treino");
    return;
  }
  const docSnap = await getDoc(doc(db, "treinos", treinoId));
  if (!docSnap.exists()) {
    alert("Treino n√£o encontrado");
    return;
  }
  const data = docSnap.data();
  grupos = data.grupos;
  atual = 0;
  dadosPreenchidos = {};
  treinoSelect.disabled = true;
  iniciarBtn.disabled = true;
  exibirExercicio(atual);
});

function exibirExercicio(index) {
  const grupo = grupos[index];
  treinoContainer.innerHTML = "";
  const chaveGrupo = `grupo${index}`;
  if (!dadosPreenchidos[chaveGrupo]) {
    dadosPreenchidos[chaveGrupo] = Array.from({ length: grupo.serie }).map(() => ({
      repeticoes: grupo.repeticao || '',
      carga: '',
      check: false,
      tempo: "01:00"
    }));
  }

  const div = document.createElement("div");
  div.className = "card";

  div.innerHTML = `
    <div class="atividade-header">
      <h2>${grupo.grupo}</h2>
    </div>

    <div class="series">
      ${dadosPreenchidos[chaveGrupo].map((serie, i) => `
        <div>
          <label>S√©rie ${i + 1}</label>
          <input type="number" placeholder="Reps" value="${serie.repeticoes}" data-serie="${i}" class="input-reps">
          <input type="number" placeholder="Carga (kg)" value="${serie.carga}" data-serie="${i}" class="input-carga">
          <button class="botao-feito ${serie.check ? 'ativo' : ''}" data-serie="${i}">‚úî</button>
          <span class="cronometro-serie ${serie.check ? '' : 'hidden'}">${serie.tempo}</span>
          <button class="botao-reiniciar ${serie.check ? '' : 'hidden'}" data-serie="${i}">üîÑ</button>
        </div>
      `).join('')}
    </div>

    <div class="botoes-controle">
      <button id="anteriorBtn" class="botao-pular">‚¨ÖÔ∏è Anterior</button>
      <button id="proximoBtn" class="botao-completar">‚û°Ô∏è Pr√≥ximo</button>
    </div>

    <button id="encerrarBtn" class="botao-encerrar" style="margin-top:20px;">‚ö° Encerrar Treino</button>
  `;

  treinoContainer.appendChild(div);

  document.querySelectorAll(".input-reps").forEach(input => {
    input.addEventListener("input", (e) => {
      const idx = e.target.dataset.serie;
      dadosPreenchidos[chaveGrupo][idx].repeticoes = e.target.value;
    });
  });

  document.querySelectorAll(".input-carga").forEach(input => {
    input.addEventListener("input", (e) => {
      const idx = e.target.dataset.serie;
      dadosPreenchidos[chaveGrupo][idx].carga = e.target.value;
    });
  });

  document.querySelectorAll(".botao-feito").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const idx = e.target.dataset.serie;
      const spanTempo = e.target.nextElementSibling;
      const btnReiniciar = spanTempo.nextElementSibling;
      const key = `${chaveGrupo}-${idx}`;

      const ativo = !dadosPreenchidos[chaveGrupo][idx].check;
      dadosPreenchidos[chaveGrupo][idx].check = ativo;
      e.target.classList.toggle("ativo", ativo);
      spanTempo.classList.toggle("hidden", !ativo);
      btnReiniciar.classList.toggle("hidden", !ativo);

      if (ativo) {
        iniciarContagem(spanTempo, chaveGrupo, idx, key);
      } else {
        pararContagem(spanTempo, chaveGrupo, idx, key);
      }
    });
  });

  document.querySelectorAll(".botao-reiniciar").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const idx = e.target.dataset.serie;
      const spanTempo = e.target.previousElementSibling;
      const key = `${chaveGrupo}-${idx}`;
      pararContagem(spanTempo, chaveGrupo, idx, key);
      iniciarContagem(spanTempo, chaveGrupo, idx, key);
    });
  });

  document.getElementById("anteriorBtn").addEventListener("click", () => {
    if (atual > 0) {
      atual--;
      exibirExercicio(atual);
    }
  });

  document.getElementById("proximoBtn").addEventListener("click", () => {
    if (atual < grupos.length - 1) {
      atual++;
      exibirExercicio(atual);
    }
  });

  document.getElementById("encerrarBtn").addEventListener("click", finalizarTreino);
}

function iniciarContagem(span, grupo, idx, key) {
  let seconds = 60;
  span.textContent = "01:00";
  clearInterval(timers[key]);
  timers[key] = setInterval(() => {
    seconds--;
    const min = String(Math.floor(seconds / 60)).padStart(2, '0');
    const seg = String(seconds % 60).padStart(2, '0');
    span.textContent = `${min}:${seg}`;
    dadosPreenchidos[grupo][idx].tempo = `${min}:${seg}`;
    if (seconds <= 0) {
      clearInterval(timers[key]);
    }
  }, 1000);
}

function pararContagem(span, grupo, idx, key) {
  clearInterval(timers[key]);
  span.textContent = "01:00";
  dadosPreenchidos[grupo][idx].tempo = "01:00";
}

async function finalizarTreino() {
  try {
    await setDoc(doc(db, "historico", Date.now().toString()), {
      data: new Date().toISOString(),
      treino: treinoSelect.options[treinoSelect.selectedIndex].text,
      resultados: dadosPreenchidos
    });
    alert("Treino finalizado e salvo no hist√≥rico!");
    treinoContainer.innerHTML = "";
    treinoSelect.disabled = false;
    iniciarBtn.disabled = false;
    treinoSelect.value = "";
    dadosPreenchidos = {};
    atual = 0;
    grupos = [];
  } catch (error) {
    alert("Erro ao salvar treino: " + error.message);
  }
}
</script>

</body>
</html>
