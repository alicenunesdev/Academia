<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meus Treinos</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="navbar">
    <h2>Academia</h2>
    <div class="navbar-links">
      <a href="index.html" class="active">Cadastro</a>
      <a href="visualizar.html">Visualizar</a>
      <a href="treino.html">Treino</a>
      <a href="historico.html">Histórico</a>
    </div>
  </nav>

  <main class="main-content">
    <button id="btnNovoTreino">➕ Criar Novo Treino</button>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal" id="modal">
        <div class="modal-header">
          <h3>Criar Novo Treino</h3>
          <button class="close-modal" onclick="fecharModal()">×</button>
        </div>
        <form id="formTreino">
          <label>Nome do Treino</label>
          <input type="text" id="nomeTreino" placeholder="Ex: Treino de Peito e Tríceps" required />

          <h4>Exercícios</h4>
          <div id="exerciciosContainer"></div>
          <button type="button" id="addExercicio">+ Adicionar</button>

          <div class="modal-footer">
            <button type="button" onclick="fecharModal()">Cancelar</button>
            <button type="submit">Criar Treino</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAQZrwPVmbcNZTEcGdqqE-Hscn2TS-hnwY",
      authDomain: "academia-bd-9d4da.firebaseapp.com",
      projectId: "academia-bd-9d4da",
      storageBucket: "academia-bd-9d4da.appspot.com",
      messagingSenderId: "201289997890",
      appId: "1:201289997890:web:19bece6aa0b3d52e3417db",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const modalOverlay = document.getElementById('modalOverlay');
    const form = document.getElementById('formTreino');
    const btnNovoTreino = document.getElementById('btnNovoTreino');
    const exerciciosContainer = document.getElementById('exerciciosContainer');
    const addExercicioBtn = document.getElementById('addExercicio');

    let contador = 1;

    btnNovoTreino.addEventListener('click', () => {
      abrirModal();
    });

    function abrirModal() {
      modalOverlay.style.display = 'flex';
      adicionarExercicio(); // Adiciona pelo menos um exercício
    }

    function fecharModal() {
      modalOverlay.style.display = 'none';
      form.reset();
      exerciciosContainer.innerHTML = '';
      contador = 1;
    }

    function adicionarExercicio() {
      const div = document.createElement('div');
      div.classList.add('exercicio');
      div.innerHTML = `
        <h5>Exercício ${contador++}</h5>
        <input type="text" placeholder="Nome do Exercício" class="ex-nome" required />
        <input type="number" placeholder="Séries" class="ex-series" required />
        <input type="number" placeholder="Repetições" class="ex-repeticoes" required />
        <input type="number" placeholder="Peso (kg)" class="ex-peso" />
        <input type="number" placeholder="Descanso (seg)" class="ex-descanso" />
      `;
      exerciciosContainer.appendChild(div);
    }

    addExercicioBtn.addEventListener('click', adicionarExercicio);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const nomeTreino = document.getElementById('nomeTreino').value.trim();
      const exercicios = Array.from(document.querySelectorAll('.exercicio')).map(ex => ({
        nome: ex.querySelector('.ex-nome').value.trim(),
        series: +ex.querySelector('.ex-series').value,
        repeticoes: +ex.querySelector('.ex-repeticoes').value,
        peso: +ex.querySelector('.ex-peso').value || 0,
        descanso: +ex.querySelector('.ex-descanso').value || 0
      }));

      if (exercicios.some(ex => !ex.nome || !ex.series || !ex.repeticoes)) {
        alert("Preencha todos os campos obrigatórios dos exercícios.");
        return;
      }

      try {
        await addDoc(collection(db, "treinos"), {
          nome: nomeTreino,
          exercicios,
          criadoEm: new Date()
        });
        alert("Treino criado com sucesso!");
        fecharModal();
      } catch (err) {
        alert("Erro ao salvar: " + err.message);
        console.error(err);
      }
    });
  </script>
</body>
</html>
